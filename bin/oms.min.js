(function(){/*
 OverlappingMarkerSpiderfier
https://github.com/jaredhobbs/OverlappingMarkerSpiderfier
Copyright (c) 2011 - 2012 George MacKerron
Released under the MIT licence: http://opensource.org/licenses/mit-license
Mapstraction port by Jared Hobbs
Note: The Mapstraction API must be included *before* this code
*/
var h=null;
(function(){var v={}.hasOwnProperty,w=[].slice;this.mxn!=h&&(this.OverlappingMarkerSpiderfier=function(){function u(c,d){var a,f,e=this;this.map=c;d==h&&(d={});for(a in d)v.call(d,a)&&(f=d[a],this[a]=f);this.t();this.d={};this.map.click.r(function(){return e.unspiderfy()});this.map.X.r(function(){return e.unspiderfy()})}var r,s,b,t;b=u.prototype;b.VERSION="0.3.1";t=2*Math.PI;b.keepSpiderfied=!1;b.markersWontHide=!1;b.markersWontMove=!1;b.nearbyDistance=20;b.circleSpiralSwitchover=9;b.circleFootSeparation=23;
b.circleStartAngle=t/12;b.spiralFootSeparation=26;b.spiralLengthStart=11;b.spiralLengthFactor=4;b.spiderfiedZIndex=1E3;b.usualLegZIndex=10;b.highlightedLegZIndex=20;b.legWeight=1.5;b.legColors={usual:{},highlighted:{}};s=b.legColors.usual;r=b.legColors.highlighted;s[mxn.b.C]=s[mxn.b.G]="#FFFFFF";r[mxn.b.C]=r[mxn.b.G]="#F00F00";s[mxn.b.D]=s[mxn.b.F]="#444444";r[mxn.b.D]=r[mxn.b.F]="#F00F00";b.t=function(){this.a=[];this.p=[]};b.addMarker=function(c){var d,a=this;if(c._oms!=h)return this;c._oms=!0;
d=function(){return a.T(c)};c.click.r(d);this.p.push(d);this.a.push(c);return this};b.$=function(c,d){if(c._omsData!=h&&(d||!c.l())&&!(this.A!=h||this.B!=h))return this.da(d?c:h)};b.getMarkers=function(){return this.a.slice(0)};b.removeMarker=function(c){var d,a;c._omsData!=h&&this.unspiderfy();d=this.s(this.a,c);if(0>d)return this;a=this.p.splice(d,1)[0];c.removeEventListener("click",a);delete c._oms;this.a.splice(d,1);return this};b.clearMarkers=function(){var c,d,a,f,e;this.unspiderfy();e=this.a;
c=a=0;for(f=e.length;a<f;c=++a)d=e[c],c=this.p[c],d.removeEventListener("click",c),delete d._oms;this.t();return this};b.addListener=function(c,d){var a,f;((f=(a=this.d)[c])!=h?f:a[c]=[]).push(d);return this};b.removeListener=function(c,d){var a;a=this.s(this.d[c],d);0>a||this.d[c].splice(a,1);return this};b.clearListeners=function(c){this.d[c]=[];return this};b.i=function(){var c,d,a,f,e,g;d=arguments[0];c=2<=arguments.length?w.call(arguments,1):[];d=(a=this.d[d])!=h?a:[];g=[];f=0;for(e=d.length;f<
e;f++)a=d[f],g.push(a.apply(h,c));return g};b.I=function(c,d){var a,f,e,g,b;e=this.circleFootSeparation*(2+c)/t;f=t/c;b=[];for(a=g=0;0<=c?g<c:g>c;a=0<=c?++g:--g)a=this.circleStartAngle+a*f,b.push(new mxn.k(d.x+e*Math.cos(a),d.y+e*Math.sin(a)));return b};b.J=function(c,d){var a,f,e,g,b;e=this.spiralLengthStart;a=0;b=[];for(f=g=0;0<=c?g<c:g>c;f=0<=c?++g:--g)a+=this.spiralFootSeparation/e+5E-4*f,f=new mxn.k(d.x+e*Math.cos(a),d.y+e*Math.sin(a)),e+=t*this.spiralLengthFactor/a,b.push(f);return b};b.T=function(c){var d,
a,f,e,b,l,m,k,n;e=c._omsData!=h;(!e||!this.keepSpiderfied)&&this.unspiderfy();if(e||"GoogleEarthAPI"===this.map.g())return this.i("click",c);e=[];b=[];d=this.nearbyDistance;l=d*d;f=this.e(c.location);n=this.a;m=0;for(k=n.length;m<k;m++)d=n[m],a=this.e(d.location),this.h(a,f)<l?e.push({O:d,u:a}):b.push(d);return 1===e.length?this.i("click",c):this.U(e,b)};b.markersNearMarker=function(c,d){var a,f,e,b,l,m,k,n,p,q;d==h&&(d=!1);if(this.Q.K()==h)throw"Must wait for 'idle' event on map before calling markersNearMarker";
a=this.nearbyDistance;l=a*a;e=this.e(c.location);b=[];n=this.a;m=0;for(k=n.length;m<k;m++)if(a=n[m],!(a===c||a.map==h||!a.l()))if(f=this.e((p=(q=a._omsData)!=h?q.j:void 0)!=h?p:a.location),this.h(f,e)<l&&(b.push(a),d))break;return b};b.markersNearAnyOtherMarker=function(){var c,d,a,f,e,b,l,m,k,n,p,q;if(this.Q.K()==h)throw"Must wait for 'idle' event on map before calling markersNearAnyOtherMarker";b=this.nearbyDistance;c=b*b;f=this.a;b=[];p=0;for(a=f.length;p<a;p++)d=f[p],b.push({v:this.e((l=(k=d._omsData)!=
h?k.j:void 0)!=h?l:d.location),f:!1});p=this.a;d=l=0;for(k=p.length;l<k;d=++l)if(a=p[d],a.map!=h&&a.l()&&(f=b[d],!f.f)){q=this.a;a=m=0;for(n=q.length;m<n;a=++m)if(e=q[a],a!==d&&(e.map!=h&&e.l())&&(e=b[a],(!(a<d)||e.f)&&this.h(f.v,e.v)<c)){f.f=e.f=!0;break}}p=this.a;a=[];c=l=0;for(k=p.length;l<k;c=++l)d=p[c],b[c].f&&a.push(d);return a};b.N=function(c){var d=this;return{m:function(){c._omsData.c.w(d.legColors.highlighted[d.map.g()]);return c._omsData.c.setAttribute("zIndex",d.highlightedLegZIndex)},
q:function(){c._omsData.c.w(d.legColors.usual[d.map.Z]);return c._omsData.c.setAttribute("zIndex",d.usualLegZIndex)}}};b.U=function(c,d){var a,b,e,g,l,m,k,n,p,q;this.A=!0;q=c.length;a=this.R(function(){var a,d,b;b=[];a=0;for(d=c.length;a<d;a++)n=c[a],b.push(n.u);return b}());g=q>=this.circleSpiralSwitchover?this.J(q,a).reverse():this.I(q,a);a=function(){var a,d,n,q=this;n=[];a=0;for(d=g.length;a<d;a++)e=g[a],b=this.S(e),p=this.P(c,function(a){return q.h(a.u,e)}),k=p.O,m=new mxn.V([k.location,b]),
m.w(this.legColors.usual[this.map.g()]),m.ba(this.legWeight),m.setAttribute("zIndex",this.usualLegZIndex),this.map.W(m),k._omsData={j:k.location,c:m},this.legColors.highlighted[this.map.g()]!==this.legColors.usual[this.map.g()]&&(l=this.N(k),k._omsData.L={m:k.addEventListener("mouseover",l.m),q:k.addEventListener("mouseout",l.q)}),k.n=b.n,k.o=k.M=b.o,k.setAttribute("zIndex",Math.round(this.spiderfiedZIndex+e.y)),n.push(k);return n}.call(this);delete this.A;this.z=!0;return this.i("spiderfy",a,d)};
b.unspiderfy=function(c){var d,a,b,e,g,l,m;c==h&&(c=h);if(this.z==h)return this;this.B=!0;e=[];b=[];m=this.a;g=0;for(l=m.length;g<l;g++)a=m[g],a._omsData!=h?(this.map.aa(a._omsData.c),a!==c&&(a.n=a._omsData.j.n),a!==c&&(a.o=a.M=a._omsData.j.o),a.setAttribute("zIndex",h),d=a._omsData.L,d!=h&&(a.removeEventListener(d.m),a.removeEventListener(d.q)),delete a._omsData,e.push(a)):b.push(a);delete this.B;delete this.z;this.i("unspiderfy",e,b);return this};b.h=function(c,d){var a,b;a=c.x-d.x;b=c.y-d.y;return a*
a+b*b};b.R=function(c){var d,a,b,e,g;e=a=b=0;for(g=c.length;e<g;e++)d=c[e],a+=d.x,b+=d.y;c=c.length;return new mxn.k(a/c,b/c)};b.e=function(c){return c.ca(this.map.H)};b.S=function(c){return mxn.k(0,0).Y(this.map.H,c)};b.P=function(c,d){var a,b,e,g,l;b=g=0;for(l=c.length;g<l;b=++g)b=c[b],e=d(b);if("undefined"===typeof a||a===h||void 0>e)a=b;return c.splice(a,1)[0]};b.s=function(c,b){var a,f,e,g;if(c.indexOf!=h)return c.indexOf(b);a=e=0;for(g=c.length;e<g;a=++e)if(f=c[a],f===b)return a;return-1};return u}())}).call(this);}).call(this);
/* Fri Apr 5 15:35:13 MDT 2013 */
